From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nassim Jahnke <jahnke.nassim@gmail.com>
Date: Thu, 28 Jul 2022 01:57:24 +0200
Subject: [PATCH] Dont fire preview event for console


diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index c34bf49b642c864f5a3a2467b951cbfe16908021..46fcecbfb3f866ba89036a11113c8ad0989b04bc 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -2600,6 +2600,11 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
 
     public ChatDecorator getChatDecorator() {
         return (entityplayer, ichatbasecomponent) -> {
+            // Paper start - fix non-player sender
+            if (entityplayer == null) {
+                return CompletableFuture.completedFuture(ichatbasecomponent);
+            }
+            // Paper end
             return CompletableFuture.supplyAsync(() -> {
                 AsyncPlayerChatPreviewEvent event = new AsyncPlayerChatPreviewEvent(true, entityplayer.getBukkitEntity(), CraftChatMessage.fromComponent(ichatbasecomponent), new LazyPlayerSet(this));
                 String originalFormat = event.getFormat(), originalMessage = event.getMessage();
