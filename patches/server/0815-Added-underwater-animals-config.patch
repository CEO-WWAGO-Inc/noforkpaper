From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: adrian-kong <adrian.k1234567890@gmail.com>
Date: Sat, 2 Oct 2021 23:48:21 +1000
Subject: [PATCH] Added underwater animals config


diff --git a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
index 416ecbdf244716c2fb1277d7d1df697fe6f77756..97895afed71a51027f452e2bc0f74b3bfea2e854 100644
--- a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
@@ -709,12 +709,14 @@ public class PaperWorldConfig {
     public int spawnLimitMonsters = -1;
     public int spawnLimitAnimals = -1;
     public int spawnLimitWaterAnimals = -1;
+    public int spawnLimitUnderwaterAnimals = -1;
     public int spawnLimitWaterAmbient = -1;
     public int spawnLimitAmbient = -1;
     private void perWorldSpawnLimits() {
         spawnLimitMonsters = getInt("spawn-limits.monsters", spawnLimitMonsters);
         spawnLimitAnimals = getInt("spawn-limits.animals", spawnLimitAnimals);
         spawnLimitWaterAnimals = getInt("spawn-limits.water-animals", spawnLimitWaterAnimals);
+        spawnLimitUnderwaterAnimals = getInt("spawn-limits.underwater-animals", spawnLimitUnderwaterAnimals);
         spawnLimitWaterAmbient = getInt("spawn-limits.water-ambient", spawnLimitWaterAmbient);
         spawnLimitAmbient = getInt("spawn-limits.ambient", spawnLimitAmbient);
     }
diff --git a/src/main/java/net/minecraft/world/level/NaturalSpawner.java b/src/main/java/net/minecraft/world/level/NaturalSpawner.java
index 0b228b8bcae5ed2840ab244b6de35732f737504d..d4feb88c5d2be11db15ad579d440230be6ffd8de 100644
--- a/src/main/java/net/minecraft/world/level/NaturalSpawner.java
+++ b/src/main/java/net/minecraft/world/level/NaturalSpawner.java
@@ -197,6 +197,7 @@ public final class NaturalSpawner {
             case MONSTER -> world.getWorld().getMonsterSpawnLimit();
             case CREATURE -> world.getWorld().getAnimalSpawnLimit();
             case WATER_CREATURE -> world.getWorld().getWaterAnimalSpawnLimit();
+            case UNDERGROUND_WATER_CREATURE -> world.getWorld().getUnderwaterAnimalSpawnLimit();
             case AMBIENT -> world.getWorld().getAmbientSpawnLimit();
             case WATER_AMBIENT -> world.getWorld().getWaterAmbientSpawnLimit();
             default -> enumcreaturetype.getMaxInstancesPerChunk();
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index 50f17369032e3463022bcc43404b5b917a209bfc..002204d35b676ca8d8bcb96e96cf765707490fc1 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -269,6 +269,7 @@ public final class CraftServer implements Server {
     private int monsterSpawn = -1;
     private int animalSpawn = -1;
     private int waterAnimalSpawn = -1;
+    private int underwaterAnimalSpawn = -1;
     private int waterAmbientSpawn = -1;
     private int ambientSpawn = -1;
     private File container;
@@ -359,6 +360,7 @@ public final class CraftServer implements Server {
         this.monsterSpawn = this.configuration.getInt("spawn-limits.monsters");
         this.animalSpawn = this.configuration.getInt("spawn-limits.animals");
         this.waterAnimalSpawn = this.configuration.getInt("spawn-limits.water-animals");
+        this.underwaterAnimalSpawn = this.configuration.getInt("spawn-limits.underwater-animals");
         this.waterAmbientSpawn = this.configuration.getInt("spawn-limits.water-ambient");
         this.ambientSpawn = this.configuration.getInt("spawn-limits.ambient");
         console.autosavePeriod = this.configuration.getInt("ticks-per.autosave");
@@ -870,6 +872,7 @@ public final class CraftServer implements Server {
         this.monsterSpawn = this.configuration.getInt("spawn-limits.monsters");
         this.animalSpawn = this.configuration.getInt("spawn-limits.animals");
         this.waterAnimalSpawn = this.configuration.getInt("spawn-limits.water-animals");
+        this.underwaterAnimalSpawn = this.configuration.getInt("spawn-limits.underwater-animals");
         this.waterAmbientSpawn = this.configuration.getInt("spawn-limits.water-ambient");
         this.ambientSpawn = this.configuration.getInt("spawn-limits.ambient");
         this.warningState = WarningState.value(this.configuration.getString("settings.deprecated-verbose"));
@@ -2063,6 +2066,11 @@ public final class CraftServer implements Server {
         return this.waterAnimalSpawn;
     }
 
+    @Override
+    public int getUnderwaterAnimalSpawnLimit() {
+        return this.underwaterAnimalSpawn;
+    }
+
     @Override
     public int getWaterAmbientSpawnLimit() {
         return this.waterAmbientSpawn;
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
index 883b2070fcf99cf10d44aef6dece0f7f84bfeeed..3944dbbb70325effef86cf727ea0ce447966188a 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
@@ -129,6 +129,7 @@ public class CraftWorld extends CraftRegionAccessor implements World {
     private int monsterSpawn = -1;
     private int animalSpawn = -1;
     private int waterAnimalSpawn = -1;
+    private int underwaterAnimalSpawn = -1;
     private int waterAmbientSpawn = -1;
     private int ambientSpawn = -1;
     private net.kyori.adventure.pointer.Pointers adventure$pointers; // Paper - implement pointers
@@ -213,6 +214,7 @@ public class CraftWorld extends CraftRegionAccessor implements World {
         this.monsterSpawn = this.world.paperConfig.spawnLimitMonsters;
         this.animalSpawn = this.world.paperConfig.spawnLimitAnimals;
         this.waterAnimalSpawn = this.world.paperConfig.spawnLimitWaterAnimals;
+        this.underwaterAnimalSpawn = this.world.paperConfig.spawnLimitUnderwaterAnimals;
         this.waterAmbientSpawn = this.world.paperConfig.spawnLimitWaterAmbient;
         this.ambientSpawn = this.world.paperConfig.spawnLimitAmbient;
         // Paper end
@@ -1625,6 +1627,20 @@ public class CraftWorld extends CraftRegionAccessor implements World {
         this.waterAnimalSpawn = limit;
     }
 
+    @Override
+    public int getUnderwaterAnimalSpawnLimit() {
+        if (this.underwaterAnimalSpawn < 0) {
+            return this.server.getUnderwaterAnimalSpawnLimit();
+        }
+
+        return this.underwaterAnimalSpawn;
+    }
+
+    @Override
+    public void setUnderwaterAnimalSpawnLimit(int limit) {
+        this.underwaterAnimalSpawn = limit;
+    }
+
     @Override
     public int getWaterAmbientSpawnLimit() {
         if (this.waterAmbientSpawn < 0) {
