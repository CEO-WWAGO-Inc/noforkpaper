From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: JRoy <joshroy126@gmail.com>
Date: Wed, 26 Aug 2020 23:48:38 -0400
Subject: [PATCH] Fix SPIGOT-6111


diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftHumanEntity.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftHumanEntity.java
index 98768b5df93fd1bf94858149e15a8c9a16439695..1f6ca8455f16b5ea6418d32f06bc5b4860efdf53 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftHumanEntity.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftHumanEntity.java
@@ -342,15 +342,17 @@ public class CraftHumanEntity extends CraftLivingEntity implements HumanEntity {
 
     @Override
     public InventoryView openWorkbench(Location location, boolean force) {
+        // Paper start - Fix SPIGOT-6111
+        if (location == null) {
+            location = getLocation();
+        }
+        // Paper end
         if (!force) {
             Block block = location.getBlock();
             if (block.getType() != Material.CRAFTING_TABLE) {
                 return null;
             }
         }
-        if (location == null) {
-            location = getLocation();
-        }
         getHandle().openContainer(((BlockWorkbench) Blocks.CRAFTING_TABLE).getInventory(null, getHandle().world, new BlockPosition(location.getBlockX(), location.getBlockY(), location.getBlockZ())));
         if (force) {
             getHandle().activeContainer.checkReachable = false;
@@ -360,15 +362,17 @@ public class CraftHumanEntity extends CraftLivingEntity implements HumanEntity {
 
     @Override
     public InventoryView openEnchanting(Location location, boolean force) {
+        // Paper start - Fix SPIGOT-6111
+        if (location == null) {
+            location = getLocation();
+        }
+        // Paper end
         if (!force) {
             Block block = location.getBlock();
             if (block.getType() != Material.ENCHANTING_TABLE) {
                 return null;
             }
         }
-        if (location == null) {
-            location = getLocation();
-        }
 
         // If there isn't an enchant table we can force create one, won't be very useful though.
         BlockPosition pos = new BlockPosition(location.getBlockX(), location.getBlockY(), location.getBlockZ());
