From 86d36e2e4169106adef556acf2e159c253605aa4 Mon Sep 17 00:00:00 2001
From: AJMFactsheets <AJMFactsheets@gmail.com>
Date: Mon, 2 Dec 2019 21:22:06 -0600
Subject: [PATCH] Ensure world spawn is loaded when an entity travels through
 an end portal - Fixes #2681


diff --git a/src/main/java/net/minecraft/server/Entity.java b/src/main/java/net/minecraft/server/Entity.java
index e8def7f8..acb29d81 100644
--- a/src/main/java/net/minecraft/server/Entity.java
+++ b/src/main/java/net/minecraft/server/Entity.java
@@ -2657,6 +2657,11 @@ public abstract class Entity implements INamableTileEntity, ICommandListener, Ke
                 entity.v(this);
                 entity.setPositionRotation(blockposition, entity.yaw + f, entity.pitch);
                 entity.setMot(vec3d);
+                // Paper start - Fix item deletion through exit end portal if world spawn is not loaded
+                if (!worldserver.keepSpawnInMemory) {
+                    worldserver.getChunkAt(blockposition.getX(), blockposition.getZ());
+                }
+                // Paper end
                 worldserver1.addEntityTeleport(entity);
                 // CraftBukkit start - Forward the CraftEntity to the new entity
                 this.getBukkitEntity().setHandle(entity);
-- 
2.17.1

