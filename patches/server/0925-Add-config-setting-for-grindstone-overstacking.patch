From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: uku <uku3lig@gmail.com>
Date: Mon, 18 Jul 2022 14:46:12 +0200
Subject: [PATCH] Add config setting for grindstone overstacking


diff --git a/src/main/java/io/papermc/paper/configuration/GlobalConfiguration.java b/src/main/java/io/papermc/paper/configuration/GlobalConfiguration.java
index 456595e4b7e0c7f50617aa2694b0d2dfc368ab81..2b89c70bc8ca6d595ba5fdf4490bfbc71720b796 100644
--- a/src/main/java/io/papermc/paper/configuration/GlobalConfiguration.java
+++ b/src/main/java/io/papermc/paper/configuration/GlobalConfiguration.java
@@ -142,6 +142,8 @@ public class GlobalConfiguration extends ConfigurationPart {
         public boolean performUsernameValidation = true;
         @Comment("This setting controls if players should be able to create headless pistons.")
         public boolean allowHeadlessPistons = false;
+        @Comment("This setting controls if grindstones should be able to output overstacked items (such as cursed books).")
+        public boolean allowGrindstoneOverstacking = false;
     }
 
     public Commands commands;
diff --git a/src/main/java/net/minecraft/world/inventory/GrindstoneMenu.java b/src/main/java/net/minecraft/world/inventory/GrindstoneMenu.java
index 740b778ce14f241e509f17c3a84b9ed47cdeeebe..bb5184a9571c140b6cde6d02dc57e99cc2cd2ac1 100644
--- a/src/main/java/net/minecraft/world/inventory/GrindstoneMenu.java
+++ b/src/main/java/net/minecraft/world/inventory/GrindstoneMenu.java
@@ -198,7 +198,7 @@ public class GrindstoneMenu extends AbstractContainerMenu {
                 i = Math.max(item.getMaxDamage() - l, 0);
                 itemstack2 = this.mergeEnchants(itemstack, itemstack1);
                 if (!itemstack2.isDamageableItem()) {
-                    if (!ItemStack.matches(itemstack, itemstack1) || itemstack2.getMaxStackSize() == 1) { // Paper - add max stack size check
+                    if (!ItemStack.matches(itemstack, itemstack1) || (itemstack2.getMaxStackSize() == 1 && !io.papermc.paper.configuration.GlobalConfiguration.get().unsupportedSettings.allowGrindstoneOverstacking)) { // Paper - add max stack size check + config value
                         this.resultSlots.setItem(0, ItemStack.EMPTY);
                         this.broadcastChanges();
                         return;
