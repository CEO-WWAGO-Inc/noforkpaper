From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Lulu13022002 <41980282+Lulu13022002@users.noreply.github.com>
Date: Thu, 8 Dec 2022 18:52:05 +0100
Subject: [PATCH] Don't teleport player rider


diff --git a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index d31a345edfffe39f127073fc3aec8b3489bae79c..b3b68219e0f794ee942197b7aa666bfef4c6910c 100644
--- a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -689,7 +689,7 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Tic
                 Location curPos = this.getCraftPlayer().getLocation(); // Spigot
 
                 entity.absMoveTo(d3, d4, d5, f, f1);
-                this.player.absMoveTo(d3, d4, d5, this.player.getYRot(), this.player.getXRot()); // CraftBukkit
+                // this.player.absMoveTo(d3, d4, d5, this.player.getYRot(), this.player.getXRot()); // CraftBukkit // Paper don't teleport
 
                 // Paper start - optimise out extra getCubes
                 boolean teleportBack = flag2; // violating this is always a fail
@@ -702,7 +702,7 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Tic
                 }
                 if (teleportBack) { // Paper end - optimise out extra getCubes
                     entity.absMoveTo(d0, d1, d2, f, f1);
-                    this.player.absMoveTo(d0, d1, d2, this.player.getYRot(), this.player.getXRot()); // CraftBukkit
+                    // this.player.absMoveTo(d0, d1, d2, this.player.getYRot(), this.player.getXRot()); // CraftBukkit // Paper don't teleport
                     this.connection.send(new ClientboundMoveVehiclePacket(entity));
                     return;
                 }
@@ -710,7 +710,7 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Tic
                 // CraftBukkit start - fire PlayerMoveEvent
                 Player player = this.getCraftPlayer();
                 // Spigot Start
-                if ( !this.hasMoved )
+                if (false && !this.hasMoved ) // Paper
                 {
                     this.lastPosX = curPos.getX();
                     this.lastPosY = curPos.getY();
@@ -724,14 +724,14 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Tic
                 Location to = player.getLocation().clone(); // Start off the To location as the Players current location.
 
                 // If the packet contains movement information then we update the To location with the correct XYZ.
-                to.setX(packet.getX());
-                to.setY(packet.getY());
+                /*to.setX(packet.getX());
+                to.setY(packet.getY()); // todo wrong rider Y pos but since mojang hasn't exposed a good way to expose the rider offset there no way to do it without emulating the positionRider
                 to.setZ(packet.getZ());
 
 
                 // If the packet contains look information then we update the To location with the correct Yaw & Pitch.
                 to.setYaw(packet.getYRot());
-                to.setPitch(packet.getXRot());
+                to.setPitch(packet.getXRot());*/
 
                 // Prevent 40 event-calls for less than a single pixel of movement >.>
                 double delta = Math.pow(this.lastPosX - to.getX(), 2) + Math.pow(this.lastPosY - to.getY(), 2) + Math.pow(this.lastPosZ - to.getZ(), 2);
