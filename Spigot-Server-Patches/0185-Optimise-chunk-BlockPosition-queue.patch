From 68c9370f21fb80b8f7213ea9d6c9005c6d22cfbc Mon Sep 17 00:00:00 2001
From: Alfie Cleveland <alfeh@me.com>
Date: Sun, 4 Dec 2016 22:57:14 +0000
Subject: [PATCH] Optimise chunk BlockPosition queue


diff --git a/src/main/java/net/minecraft/server/Chunk.java b/src/main/java/net/minecraft/server/Chunk.java
index d850dbf..d1044af 100644
--- a/src/main/java/net/minecraft/server/Chunk.java
+++ b/src/main/java/net/minecraft/server/Chunk.java
@@ -1111,10 +1111,10 @@ public class Chunk {
         if (!this.lit && this.done && this.world.spigotConfig.randomLightUpdates) { // Spigot - also use random light updates setting to determine if we should relight
             this.o();
         }
-
-        while (!this.y.isEmpty()) {
-            BlockPosition blockposition = (BlockPosition) this.y.poll();
-
+        // Paper start
+        BlockPosition blockposition;
+        while ((blockposition = this.y.poll()) != null) {
+        // Paper end
             if (this.a(blockposition, Chunk.EnumTileEntityState.CHECK) == null && this.getBlockData(blockposition).getBlock().isTileEntity()) {
                 TileEntity tileentity = this.g(blockposition);
 
-- 
2.9.3 (Apple Git-75)

