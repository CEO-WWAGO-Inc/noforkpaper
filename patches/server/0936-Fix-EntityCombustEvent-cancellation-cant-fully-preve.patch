From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Denery <dorofeevij@gmail.com>
Date: Mon, 31 Oct 2022 14:20:52 +0300
Subject: [PATCH] 
 Fix-EntityCombustEvent-cancellation-cant-fully-prevent-entities-from-being-set-on-fire


diff --git a/src/main/java/net/minecraft/world/entity/Entity.java b/src/main/java/net/minecraft/world/entity/Entity.java
index f2908cf61ff28bef44fcf46b15cf585e942fd7ce..97ef2f3a7b076805b4520bc5ca771652be3f968f 100644
--- a/src/main/java/net/minecraft/world/entity/Entity.java
+++ b/src/main/java/net/minecraft/world/entity/Entity.java
@@ -3137,6 +3137,11 @@ public abstract class Entity implements Nameable, EntityAccess, CommandSource {
             if (!entityCombustEvent.isCancelled()) {
                 this.setSecondsOnFire(entityCombustEvent.getDuration(), false);
             }
+            // Paper start - fix EntityCombustEvent cancellation.
+            else {
+                this.setRemainingFireTicks(this.remainingFireTicks - 1);
+            }
+            // Paper end
             // CraftBukkit end
         }
 
diff --git a/src/main/java/net/minecraft/world/level/block/BaseFireBlock.java b/src/main/java/net/minecraft/world/level/block/BaseFireBlock.java
index a76c452dc5c2069a3071aec31bfb3e977867161e..efd6371bded4fab6435b3976b1f96eb0c918aa48 100644
--- a/src/main/java/net/minecraft/world/level/block/BaseFireBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/BaseFireBlock.java
@@ -132,6 +132,11 @@ public abstract class BaseFireBlock extends Block {
                 if (!event.isCancelled()) {
                     entity.setSecondsOnFire(event.getDuration(), false);
                 }
+                // Paper start - fix EntityCombustEvent cancellation.
+                else {
+                    entity.setRemainingFireTicks(entity.getRemainingFireTicks() - 1);
+                }
+                // Paper end
                 // CraftBukkit end
             }
         }
