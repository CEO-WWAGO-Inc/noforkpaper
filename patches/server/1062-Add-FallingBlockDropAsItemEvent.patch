From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Esophose <esophose@gmail.com>
Date: Sat, 6 Jan 2024 20:43:40 -0700
Subject: [PATCH] Add FallingBlockDropAsItemEvent


diff --git a/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java b/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
index 45c07733f03b5c11f6d8e820f65dc950c70d9a67..ddc3a31a94f827221fd98bd8e0ece53f6ad877f4 100644
--- a/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
+++ b/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
@@ -424,4 +424,16 @@ public class FallingBlockEntity extends Entity {
         this.setPos(d0, d1, d2);
         this.setStartPos(this.blockPosition());
     }
+
+    // Paper start - call FallingBlockDropAsItemEvent
+    @Override
+    public ItemEntity spawnAtLocation(ItemLike item) {
+        org.bukkit.inventory.ItemStack toDrop = new ItemStack(item.asItem()).asBukkitCopy();
+        io.papermc.paper.event.entity.FallingBlockDropAsItemEvent event = new io.papermc.paper.event.entity.FallingBlockDropAsItemEvent((org.bukkit.entity.FallingBlock) this.getBukkitEntity(), toDrop);
+        if (event.callEvent()) {
+            return super.spawnAtLocation(org.bukkit.craftbukkit.inventory.CraftItemStack.asNMSCopy(event.getItem()));
+        }
+        return null;
+    }
+    // Paper end
 }
