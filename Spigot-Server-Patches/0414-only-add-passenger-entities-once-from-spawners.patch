From 9eebf1fc4161bc48ccf528edb3c267abdc07e367 Mon Sep 17 00:00:00 2001
From: kickash32 <kickash32@gmail.com>
Date: Wed, 21 Aug 2019 23:57:32 +0500
Subject: [PATCH] only add passenger entities once from spawners


diff --git a/src/main/java/net/minecraft/server/EntitySpider.java b/src/main/java/net/minecraft/server/EntitySpider.java
index 3929c86f..f373d0e6 100644
--- a/src/main/java/net/minecraft/server/EntitySpider.java
+++ b/src/main/java/net/minecraft/server/EntitySpider.java
@@ -125,7 +125,7 @@ public class EntitySpider extends EntityMonster {
 
             entityskeleton.setPositionRotation(this.locX, this.locY, this.locZ, this.yaw, 0.0F);
             entityskeleton.prepare(generatoraccess, difficultydamagescaler, enummobspawn, (GroupDataEntity) null, (NBTTagCompound) null);
-            generatoraccess.addEntity(entityskeleton, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.JOCKEY); // CraftBukkit - add SpawnReason
+            entityskeleton.spawnReason = org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.JOCKEY; // Paper
             entityskeleton.startRiding(this);
         }
 
diff --git a/src/main/java/net/minecraft/server/EntityZombie.java b/src/main/java/net/minecraft/server/EntityZombie.java
index 99b2e781..89175afb 100644
--- a/src/main/java/net/minecraft/server/EntityZombie.java
+++ b/src/main/java/net/minecraft/server/EntityZombie.java
@@ -497,7 +497,7 @@ public class EntityZombie extends EntityMonster {
                     entitychicken1.setPositionRotation(this.locX, this.locY, this.locZ, this.yaw, 0.0F);
                     entitychicken1.prepare(generatoraccess, difficultydamagescaler, EnumMobSpawn.JOCKEY, (GroupDataEntity) null, (NBTTagCompound) null);
                     entitychicken1.r(true);
-                    generatoraccess.addEntity(entitychicken1, CreatureSpawnEvent.SpawnReason.MOUNT); // CraftBukkit
+                    entitychicken1.spawnReason = CreatureSpawnEvent.SpawnReason.MOUNT; // Paper
                     this.startRiding(entitychicken1);
                 }
             }
diff --git a/src/main/java/net/minecraft/server/MobSpawnerAbstract.java b/src/main/java/net/minecraft/server/MobSpawnerAbstract.java
index b05f6c2f..f6737f28 100644
--- a/src/main/java/net/minecraft/server/MobSpawnerAbstract.java
+++ b/src/main/java/net/minecraft/server/MobSpawnerAbstract.java
@@ -195,7 +195,8 @@ public abstract class MobSpawnerAbstract {
     }
 
     private void a(Entity entity) {
-        if (this.a().addEntity(entity, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.SPAWNER)) { // CraftBukkit
+
+        if (this.a().addEntity(entity, entity.spawnReason != null ? entity.spawnReason : org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.SPAWNER)) { // CraftBukkit // Paper
             Iterator iterator = entity.getPassengers().iterator();
 
             while (iterator.hasNext()) {
-- 
2.22.0

