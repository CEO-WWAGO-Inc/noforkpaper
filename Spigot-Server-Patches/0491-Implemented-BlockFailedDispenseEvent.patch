From f29037a5d41b3054fd8acb5bb950ab1e801fbbdf Mon Sep 17 00:00:00 2001
From: TheViperShow <29604693+TheViperShow@users.noreply.github.com>
Date: Wed, 22 Apr 2020 09:40:38 +0200
Subject: [PATCH] Implemented BlockFailedDispenseEvent


diff --git a/src/main/java/net/minecraft/server/BlockDispenser.java b/src/main/java/net/minecraft/server/BlockDispenser.java
index 91389911..9908c269 100644
--- a/src/main/java/net/minecraft/server/BlockDispenser.java
+++ b/src/main/java/net/minecraft/server/BlockDispenser.java
@@ -1,5 +1,6 @@
 package net.minecraft.server;
 
+import com.destroystokyo.paper.event.block.BlockFailedDispenseEvent;
 import it.unimi.dsi.fastutil.objects.Object2ObjectOpenHashMap;
 import java.util.Map;
 import java.util.Random;
@@ -54,6 +55,11 @@ public class BlockDispenser extends BlockTileEntity {
 
         if (i < 0) {
             world.triggerEffect(1001, blockposition, 0);
+            // Paper start - BlockFailedDispenseEvent is called here
+            org.bukkit.block.Block block = world.getWorld().getBlockAt(blockposition.x, blockposition.y, blockposition.z);
+            BlockFailedDispenseEvent blockFailedDispenseEvent = new BlockFailedDispenseEvent(block);
+            blockFailedDispenseEvent.callEvent();
+            // Paper end
         } else {
             ItemStack itemstack = tileentitydispenser.getItem(i);
             IDispenseBehavior idispensebehavior = this.a(itemstack);
diff --git a/src/main/java/net/minecraft/server/BlockDropper.java b/src/main/java/net/minecraft/server/BlockDropper.java
index f244f2d5..fe5555e0 100644
--- a/src/main/java/net/minecraft/server/BlockDropper.java
+++ b/src/main/java/net/minecraft/server/BlockDropper.java
@@ -1,6 +1,7 @@
 package net.minecraft.server;
 
 // CraftBukkit start
+import com.destroystokyo.paper.event.block.BlockFailedDispenseEvent;
 import org.bukkit.craftbukkit.inventory.CraftItemStack;
 import org.bukkit.event.inventory.InventoryMoveItemEvent;
 // CraftBukkit end
@@ -31,6 +32,11 @@ public class BlockDropper extends BlockDispenser {
 
         if (i < 0) {
             world.triggerEffect(1001, blockposition, 0);
+            // Paper start - BlockFailedDispenseEvent is called here
+            org.bukkit.block.Block block = world.getWorld().getBlockAt(blockposition.x, blockposition.y, blockposition.z);
+            BlockFailedDispenseEvent blockFailedDispenseEvent = new BlockFailedDispenseEvent(block);
+            blockFailedDispenseEvent.callEvent();
+            // Paper end
         } else {
             ItemStack itemstack = tileentitydispenser.getItem(i);
 
-- 
2.26.0.windows.1

