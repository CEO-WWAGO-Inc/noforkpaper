From 8071a5ef7c8dcdde949b15fef8891a6ec1fbf14e Mon Sep 17 00:00:00 2001
From: Zach Brown <zach.brown@destroystokyo.com>
Date: Sun, 31 Jul 2016 16:33:03 -0500
Subject: [PATCH] Re-track players that dismount from other players


diff --git a/src/main/java/net/minecraft/server/EntityPlayer.java b/src/main/java/net/minecraft/server/EntityPlayer.java
index 6595dca86..a9827322c 100644
--- a/src/main/java/net/minecraft/server/EntityPlayer.java
+++ b/src/main/java/net/minecraft/server/EntityPlayer.java
@@ -979,6 +979,14 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
         if (!this.isSpectator()) {
             super.b(blockposition);
         }
+        // Paper start - "Fixes" an issue in which the vehicle player would not be notified that the passenger dismounted
+        if (entity instanceof EntityPlayer) {
+            // TODO verify this solution
+            WorldServer worldServer = (WorldServer) entity.getWorld();
+            worldServer.getChunkProvider().playerChunkMap.removeEntity(this);
+            worldServer.getChunkProvider().playerChunkMap.addEntity(this);
+        }
+        // Paper end
 
     }
 
-- 
2.17.1

