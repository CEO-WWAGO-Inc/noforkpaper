<<<<<<< HEAD
From ba6243239e101c2806775278a74012ce46ee1225 Mon Sep 17 00:00:00 2001
=======
From 0c006970ef9bbf08b0d317a44df34104f25612e8 Mon Sep 17 00:00:00 2001
>>>>>>> upstream/master
From: Zach Brown <zach.brown@destroystokyo.com>
Date: Sun, 31 Jul 2016 16:33:03 -0500
Subject: [PATCH] Re-track players that dismount from other players


diff --git a/src/main/java/net/minecraft/server/EntityPlayer.java b/src/main/java/net/minecraft/server/EntityPlayer.java
<<<<<<< HEAD
index 12fa705b0..f3ce154ba 100644
--- a/src/main/java/net/minecraft/server/EntityPlayer.java
+++ b/src/main/java/net/minecraft/server/EntityPlayer.java
@@ -962,6 +962,14 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
=======
index d4bba876d0..ae1f0d5783 100644
--- a/src/main/java/net/minecraft/server/EntityPlayer.java
+++ b/src/main/java/net/minecraft/server/EntityPlayer.java
@@ -997,6 +997,14 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
         if (entity1 != entity && this.playerConnection != null) {
>>>>>>> upstream/master
             this.playerConnection.a(this.locX(), this.locY(), this.locZ(), this.yaw, this.pitch);
         }
 
+        // Paper start - "Fixes" an issue in which the vehicle player would not be notified that the passenger dismounted
+        if (entity instanceof EntityPlayer) {
+            // TODO verify this solution
+            WorldServer worldServer = (WorldServer) entity.getWorld();
+            worldServer.getChunkProvider().playerChunkMap.removeEntity(this);
+            worldServer.getChunkProvider().playerChunkMap.addEntity(this);
+        }
+        // Paper end
     }
 
<<<<<<< HEAD
     @Override
@@ -1007,7 +1015,6 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
=======
@@ -1013,7 +1021,6 @@ public class EntityPlayer extends EntityHuman implements ICrafting {
>>>>>>> upstream/master
         if (!this.isSpectator()) {
             super.b(blockposition);
         }
-
     }
 
     public void a(double d0, boolean flag) {
-- 
<<<<<<< HEAD
2.20.1
=======
2.25.0.windows.1
>>>>>>> upstream/master

