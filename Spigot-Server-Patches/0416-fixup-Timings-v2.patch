From 69634730c359149674b7251037ded5c4b08c7232 Mon Sep 17 00:00:00 2001
From: Spottedleaf <Spottedleaf@users.noreply.github.com>
Date: Thu, 22 Aug 2019 23:29:12 -0700
Subject: [PATCH] fixup! Timings v2


diff --git a/src/main/java/co/aikar/timings/WorldTimingsHandler.java b/src/main/java/co/aikar/timings/WorldTimingsHandler.java
index f4d5db02f7..0b838d2822 100644
--- a/src/main/java/co/aikar/timings/WorldTimingsHandler.java
+++ b/src/main/java/co/aikar/timings/WorldTimingsHandler.java
@@ -8,6 +8,9 @@ import net.minecraft.server.WorldServer;
  */
 // TODO: Re-implement missing timers
 public class WorldTimingsHandler {
+    public final Timing playerViewDistanceMapUpdate;
+    public final Timing playerViewDistanceMapAdd;
+    public final Timing playerViewDistanceMapRemove;
     public final Timing mobSpawn;
     public final Timing doChunkUnload;
     public final Timing doPortalForcer;
@@ -72,6 +75,9 @@ public class WorldTimingsHandler {
     public WorldTimingsHandler(World server) {
         String name = server.worldData.getName() +" - ";
 
+        playerViewDistanceMapUpdate = Timings.ofSafe("Player View Distance Map - Update");
+        playerViewDistanceMapAdd = Timings.ofSafe("Player View Distance Map - Add");
+        playerViewDistanceMapRemove = Timings.ofSafe("Player View Distance Map - Remove");
         mobSpawn = Timings.ofSafe(name + "mobSpawn");
         doChunkUnload = Timings.ofSafe(name + "doChunkUnload");
         scheduledBlocks = Timings.ofSafe(name + "Scheduled Blocks");
diff --git a/src/main/java/net/minecraft/server/PlayerChunkMap.java b/src/main/java/net/minecraft/server/PlayerChunkMap.java
index febd8f7581..c0b6ef77da 100644
--- a/src/main/java/net/minecraft/server/PlayerChunkMap.java
+++ b/src/main/java/net/minecraft/server/PlayerChunkMap.java
@@ -1282,15 +1282,21 @@ public class PlayerChunkMap extends IChunkLoader implements PlayerChunk.d {
 
     // Paper start
     void addPlayerToDistanceMaps(EntityPlayer player) {
+        try (co.aikar.timings.Timing ignored = this.world.timings.playerViewDistanceMapAdd.startTiming()) { // Paper - timings
         this.updateMaps(player);
+        } // Paper - timings
     }
 
     void removePlayerFromDistanceMaps(EntityPlayer player) {
+        try (co.aikar.timings.Timing ignored = this.world.timings.playerViewDistanceMapRemove.startTiming()) { // Paper - timings
         this.playerViewDistanceMap.remove(player);
+        } // Paper - timings
     }
 
     void updateDistanceMaps(EntityPlayer player) {
+        try (co.aikar.timings.Timing ignored = this.world.timings.playerViewDistanceMapUpdate.startTiming()) { // Paper - timings
         this.updateMaps(player);
+        } // Paper - timings
     }
 
     private void updateMaps(EntityPlayer player) {
-- 
2.22.1

