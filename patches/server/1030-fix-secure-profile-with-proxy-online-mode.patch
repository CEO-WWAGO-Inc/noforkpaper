From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: NonSwag <mrminecraft00@gmail.com>
Date: Sun, 10 Sep 2023 18:25:44 +0200
Subject: [PATCH] fix secure profile with proxy online mode


diff --git a/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java b/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
index c49802c936ae8e3f4dc1badd98414d96714ecd60..c7fef43dd7d9fc1a4d63c17213d154ad2c2e51fe 100644
--- a/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
+++ b/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
@@ -638,7 +638,12 @@ public class DedicatedServer extends MinecraftServer implements ServerInterface
     public boolean enforceSecureProfile() {
         DedicatedServerProperties dedicatedserverproperties = this.getProperties();
 
-        return dedicatedserverproperties.enforceSecureProfile && dedicatedserverproperties.onlineMode && this.services.profileKeySignatureValidator() != null;
+        // Paper - fix secure profile with proxy online mode
+        return dedicatedserverproperties.enforceSecureProfile
+            && (dedicatedserverproperties.onlineMode
+            || io.papermc.paper.configuration.GlobalConfiguration.get().proxies.isProxyOnlineMode())
+            && this.services.profileKeySignatureValidator() != null;
+        // Paper end
     }
 
     protected boolean convertOldUsers() {
