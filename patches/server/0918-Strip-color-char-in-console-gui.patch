From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Lulu13022002 <41980282+Lulu13022002@users.noreply.github.com>
Date: Fri, 1 Jul 2022 18:58:08 +0200
Subject: [PATCH] Strip color char in console gui


diff --git a/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java b/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java
index c07918aa1ed2469ad7a76a0add60ab648ff7f421..8da178a3c08ce139a36000d87631a5fe57ce052b 100644
--- a/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java
+++ b/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java
@@ -175,6 +175,11 @@ public class MinecraftServerGui extends JComponent {
         this.finalizers.forEach(Runnable::run);
     }
 
+    // Paper start
+    private static final char COLOR_CHAR = 0x7f;
+    private static final java.util.regex.Pattern COLOR_PATTERN = java.util.regex.Pattern.compile(COLOR_CHAR + "([0-9a-fk-orA-FK-OR])|" + COLOR_CHAR + "#([0-9a-fA-F]){6}");
+    // Paper end
+
     private static final java.util.regex.Pattern ANSI = java.util.regex.Pattern.compile("\\x1B\\[([0-9]{1,2}(;[0-9]{1,2})*)?[m|K]"); // CraftBukkit
     public void print(JTextArea textArea, JScrollPane scrollPane, String message) {
         if (!SwingUtilities.isEventDispatchThread()) {
@@ -191,7 +196,7 @@ public class MinecraftServerGui extends JComponent {
             }
 
             try {
-                document.insertString(document.getLength(), MinecraftServerGui.ANSI.matcher(message).replaceAll(""), (AttributeSet) null); // CraftBukkit
+                document.insertString(document.getLength(), COLOR_PATTERN.matcher(message).replaceAll(""), (AttributeSet) null); // Paper // CraftBukkit
             } catch (BadLocationException badlocationexception) {
                 ;
             }
