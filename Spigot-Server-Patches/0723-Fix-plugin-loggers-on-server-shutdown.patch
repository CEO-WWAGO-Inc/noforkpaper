From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jos=C3=A9=20Miguel=20Moreno?= <josemmo@pm.me>
Date: Sat, 8 May 2021 14:49:13 +0200
Subject: [PATCH] Fix plugin loggers on server shutdown


diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index 61712ae515b329a6b85dbe2e5960e4e864dc7731..cd7b256f1948abd610ee4cc8cb391d9cb2dacddc 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -364,6 +364,16 @@ public abstract class MinecraftServer extends IAsyncTaskHandlerReentrant<TickTas
         */
         // Paper end
         Runtime.getRuntime().addShutdownHook(new org.bukkit.craftbukkit.util.ServerShutdownThread(this));
+        // Paper start - Stop signal listener
+        sun.misc.SignalHandler stopSignalHandler = new sun.misc.SignalHandler() {
+            @Override
+            public void handle(sun.misc.Signal signal) {
+                safeShutdown(false);
+            }
+        };
+        sun.misc.Signal.handle(new sun.misc.Signal("INT"), stopSignalHandler);
+        sun.misc.Signal.handle(new sun.misc.Signal("TERM"), stopSignalHandler);
+        // Paper end
     }
     // CraftBukkit end
 
