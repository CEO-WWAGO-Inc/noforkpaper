From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: egg82 <eggys82@gmail.com>
Date: Sun, 1 Nov 2020 01:01:35 -0700
Subject: [PATCH] Add API for Zstd/LZ4 support for region files (1.16 edition)

Zstd using zstd-jni: https://github.com/luben/zstd-jni
LZ4 using lz4-java: https://github.com/lz4/lz4-java

diff --git a/src/main/java/com/destroystokyo/paper/region/RegionCompressionType.java b/src/main/java/com/destroystokyo/paper/region/RegionCompressionType.java
new file mode 100644
index 0000000000000000000000000000000000000000..60c1ad9109fbd7bf5720ecdd7c9ce045e6fe682d
--- /dev/null
+++ b/src/main/java/com/destroystokyo/paper/region/RegionCompressionType.java
@@ -0,0 +1,40 @@
+package com.destroystokyo.paper.region;
+
+public enum RegionCompressionType {
+    GZIP(1, "gzip"),
+    ZLIB(2, "zlib"),
+    NONE(3, "none"),
+    LZ4(30, "lz4"),
+    ZSTD(31, "zstd");
+
+    private final int type;
+    private final String name;
+    RegionCompressionType(int type, String name) {
+        this.type = type;
+        this.name = name;
+    }
+
+    public int getType() { return type; }
+
+    public String getName() { return name; }
+
+    public static RegionCompressionType getFromName(String name) {
+        for (RegionCompressionType value : values()) {
+            if (value.name.equalsIgnoreCase(name)) {
+                return value;
+            }
+        }
+        return null;
+    }
+
+    public static RegionCompressionType getFromType(int type) {
+        for (RegionCompressionType value : values()) {
+            if (value.type == type) {
+                return value;
+            }
+        }
+        return null;
+    }
+
+    public String toString() { return name; }
+}
diff --git a/src/main/java/org/bukkit/Bukkit.java b/src/main/java/org/bukkit/Bukkit.java
index bfe842364ee0a4bf39dacdbb6972477d57a4ef8a..d570ab3443abc50003251a4216ccaba0569374e8 100644
--- a/src/main/java/org/bukkit/Bukkit.java
+++ b/src/main/java/org/bukkit/Bukkit.java
@@ -1783,6 +1783,17 @@ public final class Bukkit {
     }
     // Paper end
 
+    // Paper start - API for compression settings
+    /**
+     * Returns the current region compression type
+     *
+     * @return the current region compression type
+     */
+    public static com.destroystokyo.paper.region.RegionCompressionType getRegionCompressionType() {
+        return server.getRegionCompressionType();
+    }
+    // Paper end
+
     @NotNull
     public static Server.Spigot spigot() {
         return server.spigot();
diff --git a/src/main/java/org/bukkit/Server.java b/src/main/java/org/bukkit/Server.java
index 7c0a788900c93c29d14d8c45ac5ae3317cf4a94e..236f1f135c807c3f52f2fecb2ab54986806dd56d 100644
--- a/src/main/java/org/bukkit/Server.java
+++ b/src/main/java/org/bukkit/Server.java
@@ -1556,4 +1556,13 @@ public interface Server extends PluginMessageRecipient {
     @NotNull
     com.destroystokyo.paper.entity.ai.MobGoals getMobGoals();
     // Paper end
+
+    // Paper start - API for compression settings
+    /**
+     * Returns the current region compression type
+     *
+     * @return the current region compression type
+     */
+    com.destroystokyo.paper.region.RegionCompressionType getRegionCompressionType();
+    // Paper end
 }
