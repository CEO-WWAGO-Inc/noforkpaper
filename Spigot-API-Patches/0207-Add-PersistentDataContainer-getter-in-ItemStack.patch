From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nesaak <52047222+Nesaak@users.noreply.github.com>
Date: Tue, 12 May 2020 17:00:24 -0400
Subject: [PATCH] Add PersistentDataContainer getter in ItemStack

Adds a new method which gets the PersistentDataContainer directly from an ItemStack.
This method is an alternative for cloning ItemMeta, getting the PDC and setting the new ItemMeta which can be much slower.

getPersistentDataContainer - Gets the ItemStacks PersistentDataContainer. If the ItemStack has no meta, it creates a new meta for it.


diff --git a/src/main/java/org/bukkit/inventory/ItemStack.java b/src/main/java/org/bukkit/inventory/ItemStack.java
index d7d6a3e83dfd88359708749f5c12be02815c3580..0e56555ed8464fb4e6753850388b09771d37bdbd 100644
--- a/src/main/java/org/bukkit/inventory/ItemStack.java
+++ b/src/main/java/org/bukkit/inventory/ItemStack.java
@@ -767,5 +767,15 @@ public class ItemStack implements Cloneable, ConfigurationSerializable {
         ItemMeta itemMeta = getItemMeta();
         return itemMeta.hasItemFlag(flag);
     }
+
+    /**
+     * Gets the PersistentDataContainer of this items current {@link ItemMeta}. Does not clone ItemMeta which can be faster than {@link #getItemMeta()}. However, this is a live map and any changes to the container will take effect without using {@link #setItemMeta()}.
+     *
+     * @return The current PersistentDataContainer of this item's meta
+     */
+    @NotNull
+    public org.bukkit.persistence.PersistentDataContainer getPersistentDataContainer() {
+        return (meta == null ? meta = Bukkit.getItemFactory().getItemMeta(type) : meta).getPersistentDataContainer();
+    }
     // Paper end
 }
