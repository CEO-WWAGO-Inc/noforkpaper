From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: jmp <jasonpenilla2@me.com>
Date: Tue, 22 Sep 2020 12:15:15 -0700
Subject: [PATCH] Support components in Nameable Entites/Blocks


diff --git a/src/main/java/org/bukkit/craftbukkit/block/CraftBeacon.java b/src/main/java/org/bukkit/craftbukkit/block/CraftBeacon.java
index 21ebceafbf27125761aa08cfe0785f6f05c77592..56d6f5c44892574795042e8112ddbb977120a1c6 100644
--- a/src/main/java/org/bukkit/craftbukkit/block/CraftBeacon.java
+++ b/src/main/java/org/bukkit/craftbukkit/block/CraftBeacon.java
@@ -81,6 +81,19 @@ public class CraftBeacon extends CraftBlockEntityState<TileEntityBeacon> impleme
         this.getSnapshot().setCustomName(CraftChatMessage.fromStringOrNull(name));
     }
 
+    // Paper start
+    @Override
+    public void setCustomNameComponent(net.md_5.bungee.api.chat.BaseComponent[] name) {
+        this.getSnapshot().setCustomName(name != null ? net.minecraft.server.IChatBaseComponent.ChatSerializer.jsonToComponent(net.md_5.bungee.chat.ComponentSerializer.toString(name)) : null);
+    }
+
+    @Override
+    public net.md_5.bungee.api.chat.BaseComponent[] getCustomNameComponent() {
+        TileEntityBeacon beacon = this.getSnapshot();
+        return beacon.customName != null ? net.md_5.bungee.chat.ComponentSerializer.parse(net.minecraft.server.IChatBaseComponent.ChatSerializer.componentToJson(beacon.customName)) : null;
+    }
+    // Paper end
+
     @Override
     public boolean isLocked() {
         return !this.getSnapshot().chestLock.key.isEmpty();
diff --git a/src/main/java/org/bukkit/craftbukkit/block/CraftContainer.java b/src/main/java/org/bukkit/craftbukkit/block/CraftContainer.java
index 36ba813e56c6e75528507c415d11e5a57a5f4ae3..12d7ed16659ad4db503e52ebe3b2521b96abce9d 100644
--- a/src/main/java/org/bukkit/craftbukkit/block/CraftContainer.java
+++ b/src/main/java/org/bukkit/craftbukkit/block/CraftContainer.java
@@ -43,6 +43,19 @@ public abstract class CraftContainer<T extends TileEntityContainer> extends Craf
         this.getSnapshot().setCustomName(CraftChatMessage.fromStringOrNull(name));
     }
 
+    // Paper start
+    @Override
+    public void setCustomNameComponent(net.md_5.bungee.api.chat.BaseComponent[] name) {
+        this.getSnapshot().setCustomName(name != null ? net.minecraft.server.IChatBaseComponent.ChatSerializer.jsonToComponent(net.md_5.bungee.chat.ComponentSerializer.toString(name)) : null);
+    }
+
+    @Override
+    public net.md_5.bungee.api.chat.BaseComponent[] getCustomNameComponent() {
+        T container = this.getSnapshot();
+        return container.customName != null ? net.md_5.bungee.chat.ComponentSerializer.parse(net.minecraft.server.IChatBaseComponent.ChatSerializer.componentToJson(container.customName)) : null;
+    }
+    // Paper end
+
     @Override
     public void applyTo(T container) {
         super.applyTo(container);
diff --git a/src/main/java/org/bukkit/craftbukkit/block/CraftEnchantingTable.java b/src/main/java/org/bukkit/craftbukkit/block/CraftEnchantingTable.java
index 3a782294c15e2c2592976858e28ec33f049cb65e..13e045066eb475b2052c16c737c9163d1ea45be0 100644
--- a/src/main/java/org/bukkit/craftbukkit/block/CraftEnchantingTable.java
+++ b/src/main/java/org/bukkit/craftbukkit/block/CraftEnchantingTable.java
@@ -27,6 +27,19 @@ public class CraftEnchantingTable extends CraftBlockEntityState<TileEntityEnchan
         this.getSnapshot().setCustomName(CraftChatMessage.fromStringOrNull(name));
     }
 
+    // Paper start
+    @Override
+    public void setCustomNameComponent(net.md_5.bungee.api.chat.BaseComponent[] name) {
+        this.getSnapshot().setCustomName(name != null ? net.minecraft.server.IChatBaseComponent.ChatSerializer.jsonToComponent(net.md_5.bungee.chat.ComponentSerializer.toString(name)) : null);
+    }
+
+    @Override
+    public net.md_5.bungee.api.chat.BaseComponent[] getCustomNameComponent() {
+        TileEntityEnchantTable enchant = this.getSnapshot();
+        return enchant.hasCustomName() ? net.md_5.bungee.chat.ComponentSerializer.parse(net.minecraft.server.IChatBaseComponent.ChatSerializer.componentToJson(enchant.getCustomName())) : null;
+    }
+    // Paper end
+
     @Override
     public void applyTo(TileEntityEnchantTable enchantingTable) {
         super.applyTo(enchantingTable);
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
index 6ceb2d50c59b63a337364605f8a5280d905f2662..f9b4175f1708c4b007b734fd0f9cef070e8e0bb8 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
@@ -836,6 +836,18 @@ public abstract class CraftEntity implements org.bukkit.entity.Entity {
         return CraftChatMessage.fromComponent(name);
     }
 
+    // Paper start
+    @Override
+    public void setCustomNameComponent(net.md_5.bungee.api.chat.BaseComponent[] name) {
+        getHandle().setCustomName(name != null ? IChatBaseComponent.ChatSerializer.jsonToComponent(net.md_5.bungee.chat.ComponentSerializer.toString(name)) : null);
+    }
+
+    @Override
+    public net.md_5.bungee.api.chat.BaseComponent[] getCustomNameComponent() {
+        return getHandle().getCustomName() != null ? net.md_5.bungee.chat.ComponentSerializer.parse(IChatBaseComponent.ChatSerializer.componentToJson(getHandle().getCustomName())) : null;
+    }
+    // Paper end
+
     @Override
     public void setCustomNameVisible(boolean flag) {
         getHandle().setCustomNameVisible(flag);
