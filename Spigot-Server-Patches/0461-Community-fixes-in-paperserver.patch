From 3c77178451af4f5e7ac23ff77b7744e8fc7b0096 Mon Sep 17 00:00:00 2001
From: DigitalRegent <misterwener@gmail.com>
Date: Mon, 6 Apr 2020 17:55:30 +0200
Subject: [PATCH] Community fixes in paperserver


diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java
index 319f12f9..82ebef88 100644
--- a/src/main/java/net/minecraft/server/PlayerConnection.java
+++ b/src/main/java/net/minecraft/server/PlayerConnection.java
@@ -106,7 +106,7 @@ public class PlayerConnection implements PacketListenerPlayIn {
     private static final int MAX_SIGN_LINE_LENGTH = Integer.getInteger("Paper.maxSignLength", 80);
     private static final long KEEPALIVE_LIMIT = Long.getLong("paper.playerconnection.keepalive", 30) * 1000; // Paper - provide property to set keepalive limit
 
-    private String clientBrandName = null;
+    private String clientBrandName = null; // Paper - Brand name
 
     public PlayerConnection(MinecraftServer minecraftserver, NetworkManager networkmanager, EntityPlayer entityplayer) {
         this.minecraftServer = minecraftserver;
@@ -2643,6 +2643,10 @@ public class PlayerConnection implements PacketListenerPlayIn {
     private static final MinecraftKey CUSTOM_REGISTER = new MinecraftKey("register");
     private static final MinecraftKey CUSTOM_UNREGISTER = new MinecraftKey("unregister");
 
+    // paper start
+    public static final MinecraftKey MINECRAFT_BRAND = new MinecraftKey("brand");
+    // paper end
+
     @Override
     public void a(PacketPlayInCustomPayload packetplayincustompayload) {
         PlayerConnectionUtils.ensureMainThread(packetplayincustompayload, this, this.player.getWorldServer());
@@ -2667,7 +2671,7 @@ public class PlayerConnection implements PacketListenerPlayIn {
                 this.disconnect("Invalid payload UNREGISTER!");
             }
         // paper start -- add brand support
-        }  else if(packetplayincustompayload.tag.equals(PacketPlayOutCustomPayload.a)) {
+        }  else if(packetplayincustompayload.tag.equals(MINECRAFT_BRAND)) { // OBFHELPER
             this.clientBrandName = packetplayincustompayload.data.readUTF(256);
             // paper end
         } else {
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index 5470c6d7..b637012b 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -2087,10 +2087,12 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
         // Paper end
     };
 
+    // paper start - brand support
     @Override
     public String getClientBrandName() {
         return getHandle().playerConnection.getClientBrandName();
     }
+    // paper end
 
     public Player.Spigot spigot()
     {
-- 
2.25.1.windows.1

