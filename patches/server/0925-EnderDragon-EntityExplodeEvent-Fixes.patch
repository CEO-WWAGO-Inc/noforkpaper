From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Owen1212055 <23108066+Owen1212055@users.noreply.github.com>
Date: Wed, 29 Jun 2022 20:50:08 -0400
Subject: [PATCH] EnderDragon EntityExplodeEvent Fixes


diff --git a/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java b/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java
index f872b60697525e3015979f286bfb08d29bb001df..605c56a3ee7f13a8b2e437a774582fdfe465a108 100644
--- a/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java
+++ b/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java
@@ -485,7 +485,7 @@ public class EnderDragon extends Mob implements Enemy {
         int i1 = Mth.floor(box.maxY);
         int j1 = Mth.floor(box.maxZ);
         boolean flag = false;
-        boolean flag1 = false;
+        boolean flag1 = false; // Paper - Diff on change
         // CraftBukkit start - Create a list to hold all the destroyed blocks
         List<org.bukkit.block.Block> destroyedBlocks = new java.util.ArrayList<org.bukkit.block.Block>();
         // CraftBukkit end
@@ -530,6 +530,7 @@ public class EnderDragon extends Mob implements Enemy {
                 this.level.removeBlock(new BlockPos(block.getX(), block.getY(), block.getZ()), false);
             }
         } else {
+            flag1 = false; // Paper
             for (org.bukkit.block.Block block : event.blockList()) {
                 org.bukkit.Material blockId = block.getType();
                 if (blockId.isAir()) {
@@ -549,14 +550,14 @@ public class EnderDragon extends Mob implements Enemy {
                     });
                     craftBlock.getNMS().spawnAfterBreak((ServerLevel) level, blockposition, ItemStack.EMPTY, false);
                 }
-                nmsBlock.wasExploded(level, blockposition, explosionSource);
+                //nmsBlock.wasExploded(level, blockposition, explosionSource); Paper - It doesn't make sense to have explosion logic here. This isn't technically an explosion.
 
-                this.level.removeBlock(blockposition, false);
+                flag1 = this.level.removeBlock(blockposition, false) || flag1; // Paper
             }
         }
         // CraftBukkit end
 
-        if (flag1) {
+        if (flag1) { // Paper - Diff on change
             BlockPos blockposition1 = new BlockPos(i + this.random.nextInt(l - i + 1), j + this.random.nextInt(i1 - j + 1), k + this.random.nextInt(j1 - k + 1));
 
             this.level.levelEvent(2008, blockposition1, 0);
