From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Connor Linfoot <connorlinfoot@me.com>
Date: Sun, 16 May 2021 15:07:34 +0100
Subject: [PATCH] Datapack API

Co-authored-by: Noah van der Aa <ndvdaa@gmail.com>

diff --git a/src/main/java/io/papermc/paper/datapack/Datapack.java b/src/main/java/io/papermc/paper/datapack/Datapack.java
new file mode 100644
index 0000000000000000000000000000000000000000..7b2ab0be10a21e0496ad1d485ff8cb2c0b92a2cb
--- /dev/null
+++ b/src/main/java/io/papermc/paper/datapack/Datapack.java
@@ -0,0 +1,32 @@
+package io.papermc.paper.datapack;
+
+import org.checkerframework.checker.nullness.qual.NonNull;
+
+public interface Datapack {
+
+    /**
+     * @return the name of the pack
+     */
+    @NonNull
+    String getName();
+
+    /**
+     * @return the compatibility of the pack
+     */
+    @NonNull
+    Compatibility getCompatibility();
+
+    /**
+     * @return whether or not the pack is currently enabled
+     */
+    boolean isEnabled();
+
+    void setEnabled(boolean enabled);
+
+    enum Compatibility {
+        TOO_OLD,
+        TOO_NEW,
+        COMPATIBLE,
+    }
+
+}
diff --git a/src/main/java/io/papermc/paper/datapack/DatapackManager.java b/src/main/java/io/papermc/paper/datapack/DatapackManager.java
new file mode 100644
index 0000000000000000000000000000000000000000..a6a7724cf5a1760deed51ea5885fbf3021b41bf7
--- /dev/null
+++ b/src/main/java/io/papermc/paper/datapack/DatapackManager.java
@@ -0,0 +1,51 @@
+package io.papermc.paper.datapack;
+
+import org.checkerframework.checker.nullness.qual.NonNull;
+import org.checkerframework.checker.nullness.qual.Nullable;
+import org.jetbrains.annotations.NotNull;
+
+import java.io.File;
+import java.io.FileNotFoundException;
+import java.io.IOException;
+import java.util.Collection;
+
+public interface DatapackManager {
+
+    /**
+     * @return all the packs known to the server
+     */
+    @NonNull
+    Collection<Datapack> getPacks();
+
+    /**
+     * @return all the packs which are currently enabled
+     */
+    @NonNull
+    Collection<Datapack> getEnabledPacks();
+
+    /**
+     * Loads a new datapack and enables it.
+     * @param name the name of the pack
+     * @param file the file to load the pack from
+     * @throws FileNotFoundException if the server can't load the pack because a file is missing
+     * @throws IOException if there was an error while reading the pack file
+     * @return the newly loaded pack
+     */
+    @Nullable
+    default Datapack loadDatapack(@NotNull String name, @NotNull File file) throws FileNotFoundException, IOException {
+        return loadDatapack(name, file, true);
+    }
+
+    /**
+     * Loads a new datapack and optionally enables it.
+     * @param name the name of the pack
+     * @param file the file to load the pack from
+     * @param enable if the pack should be enabled upon loading
+     * @throws FileNotFoundException if the server can't load the pack because a file is missing
+     * @throws IOException if there was an error while reading the pack file
+     * @return the newly loaded pack
+     */
+    @Nullable
+    Datapack loadDatapack(@NotNull String name, @NotNull File file, boolean enable) throws FileNotFoundException, IOException;
+
+}
diff --git a/src/main/java/org/bukkit/Bukkit.java b/src/main/java/org/bukkit/Bukkit.java
index 0ddad5d32494495bb797559a10336a401e445fef..05186443e25706ed77f7187eea6ac84666613a88 100644
--- a/src/main/java/org/bukkit/Bukkit.java
+++ b/src/main/java/org/bukkit/Bukkit.java
@@ -2374,6 +2374,14 @@ public final class Bukkit {
     public static com.destroystokyo.paper.entity.ai.MobGoals getMobGoals() {
         return server.getMobGoals();
     }
+
+    /**
+     * @return the datapack manager
+     */
+    @NotNull
+    public static io.papermc.paper.datapack.DatapackManager getDatapackManager() {
+        return server.getDatapackManager();
+    }
     // Paper end
 
     @NotNull
diff --git a/src/main/java/org/bukkit/Server.java b/src/main/java/org/bukkit/Server.java
index 80d762390a42070f1953a388c896cd93640b506e..3d78e555725b48cb7e5750e8b4b3f1f0463bddc2 100644
--- a/src/main/java/org/bukkit/Server.java
+++ b/src/main/java/org/bukkit/Server.java
@@ -2063,5 +2063,11 @@ public interface Server extends PluginMessageRecipient, net.kyori.adventure.audi
      */
     @NotNull
     com.destroystokyo.paper.entity.ai.MobGoals getMobGoals();
+
+    /**
+     * @return the datapack manager
+     */
+    @NotNull
+    io.papermc.paper.datapack.DatapackManager getDatapackManager();
     // Paper end
 }
