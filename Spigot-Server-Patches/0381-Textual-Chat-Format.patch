From d9c3b95e8cfa3c54a160bf97bccaa7c47b31fe18 Mon Sep 17 00:00:00 2001
From: MiniDigger <mini.digger@live.de>
Date: Fri, 28 Sep 2018 09:15:15 +0000
Subject: [PATCH] Textual Chat Format


diff --git a/src/main/java/org/bukkit/craftbukkit/command/CraftBlockCommandSender.java b/src/main/java/org/bukkit/craftbukkit/command/CraftBlockCommandSender.java
index 701a57e0..08429a20 100644
--- a/src/main/java/org/bukkit/craftbukkit/command/CraftBlockCommandSender.java
+++ b/src/main/java/org/bukkit/craftbukkit/command/CraftBlockCommandSender.java
@@ -38,6 +38,31 @@ public class CraftBlockCommandSender extends ServerCommandSender implements Bloc
         }
     }
 
+    // Paper start: textual chat format
+    // TODO fixme, allow to send actual chat 
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, String... placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, java.util.Map<String, String> placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String[] enhancedMessages) {
+        for (String message : enhancedMessages) {
+            sendEnhancedMessage(message);
+        }
+    }
+    // Paper end
+
     public String getName() {
         return block.getName();
     }
diff --git a/src/main/java/org/bukkit/craftbukkit/command/CraftConsoleCommandSender.java b/src/main/java/org/bukkit/craftbukkit/command/CraftConsoleCommandSender.java
index 9abcf92d..23f117a9 100644
--- a/src/main/java/org/bukkit/craftbukkit/command/CraftConsoleCommandSender.java
+++ b/src/main/java/org/bukkit/craftbukkit/command/CraftConsoleCommandSender.java
@@ -32,6 +32,30 @@ public class CraftConsoleCommandSender extends ServerCommandSender implements Co
         }
     }
 
+    // Paper start: textual chat format
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, String... placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, java.util.Map<String, String> placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String[] enhancedMessages) {
+        for (String message : enhancedMessages) {
+            sendEnhancedMessage(message);
+        }
+    }
+    // Paper end
+
     public String getName() {
         return "CONSOLE";
     }
diff --git a/src/main/java/org/bukkit/craftbukkit/command/CraftRemoteConsoleCommandSender.java b/src/main/java/org/bukkit/craftbukkit/command/CraftRemoteConsoleCommandSender.java
index 228e88a6..5bc4a7ee 100644
--- a/src/main/java/org/bukkit/craftbukkit/command/CraftRemoteConsoleCommandSender.java
+++ b/src/main/java/org/bukkit/craftbukkit/command/CraftRemoteConsoleCommandSender.java
@@ -24,6 +24,31 @@ public class CraftRemoteConsoleCommandSender extends ServerCommandSender impleme
         }
     }
 
+    // Paper start: textual chat format
+    // TODO fixme, allow to send actual chat 
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, String... placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, java.util.Map<String, String> placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String[] enhancedMessages) {
+        for (String message : enhancedMessages) {
+            sendEnhancedMessage(message);
+        }
+    }
+    // Paper end
+
     @Override
     public String getName() {
         return "Rcon";
diff --git a/src/main/java/org/bukkit/craftbukkit/command/ProxiedNativeCommandSender.java b/src/main/java/org/bukkit/craftbukkit/command/ProxiedNativeCommandSender.java
index 7609e861..9b834dd7 100644
--- a/src/main/java/org/bukkit/craftbukkit/command/ProxiedNativeCommandSender.java
+++ b/src/main/java/org/bukkit/craftbukkit/command/ProxiedNativeCommandSender.java
@@ -48,6 +48,30 @@ public class ProxiedNativeCommandSender implements ProxiedCommandSender {
         getCaller().sendMessage(messages);
     }
 
+    // Paper start: textual chat format
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage) {
+        getCaller().sendEnhancedMessage(enhancedMessage);
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, String... placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, java.util.Map<String, String> placeholders) {
+        sendMessage(com.destroystokyo.paper.ChatParser.toPlainText(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String[] enhancedMessages) {
+        for (String message : enhancedMessages) {
+            sendEnhancedMessage(message);
+        }
+    }
+    // Paper end
+
     @Override
     public Server getServer() {
         return getCallee().getServer();
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
index f4af6ea0..7a6350fb 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
@@ -626,6 +626,28 @@ public abstract class CraftEntity implements org.bukkit.entity.Entity {
 
     }
 
+    // Paper start: textual chat format
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage) {
+
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, String... placeholders) {
+
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, java.util.Map<String, String> placeholders) {
+
+    }
+
+    @Override
+    public void sendEnhancedMessage(String[] enhancedMessages) {
+
+    }
+    // Paper end
+
     @Override
     public String getName() {
         return CraftChatMessage.fromComponent(getHandle().getDisplayName(), EnumChatFormat.WHITE);
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index bfb2f1a1..c969485f 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -225,6 +225,30 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
         }
     }
 
+    // Paper start: textual chat format
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage) {
+        spigot().sendMessage(com.destroystokyo.paper.ChatParser.parseFormat(enhancedMessage));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, String... placeholders) {
+        spigot().sendMessage(com.destroystokyo.paper.ChatParser.parseFormat(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String enhancedMessage, Map<String, String> placeholders) {
+        spigot().sendMessage(com.destroystokyo.paper.ChatParser.parseFormat(enhancedMessage, placeholders));
+    }
+
+    @Override
+    public void sendEnhancedMessage(String[] enhancedMessages) {
+        for (String message : enhancedMessages) {
+            sendEnhancedMessage(message);
+        }
+    }
+    // Paper end
+
     // Paper start
     @Override
     public void sendActionBar(String message) {
-- 
2.17.1

