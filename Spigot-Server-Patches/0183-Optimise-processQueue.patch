From b8a78489d0f26727ef5399e178db8fd92b980a5a Mon Sep 17 00:00:00 2001
From: Alfie Cleveland <alfeh@me.com>
Date: Mon, 28 Nov 2016 23:45:06 +0000
Subject: [PATCH] Optimise processQueue


diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index b4adf7e..32a6d06 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -824,9 +824,12 @@ public abstract class MinecraftServer implements Runnable, ICommandListener, IAs
         // CraftBukkit start
         // Run tasks that are waiting on processing
         MinecraftTimings.processQueueTimer.startTiming(); // Spigot
-        while (!processQueue.isEmpty()) {
-            processQueue.remove().run();
+        // Paper start
+        Runnable runnable;
+        while ((runnable = processQueue.poll()) != null) {
+            runnable.run();
         }
+        // Paper end
         MinecraftTimings.processQueueTimer.stopTiming(); // Spigot
 
         MinecraftTimings.chunkIOTickTimer.startTiming(); // Spigot
-- 
2.9.3 (Apple Git-75)

