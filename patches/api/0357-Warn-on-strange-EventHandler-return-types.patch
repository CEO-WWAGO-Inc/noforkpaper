From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jason Penilla <11360596+jpenilla@users.noreply.github.com>
Date: Tue, 18 Jan 2022 11:07:54 -0700
Subject: [PATCH] Warn on strange @EventHandler return types


diff --git a/src/main/java/org/bukkit/plugin/EventExecutor.java b/src/main/java/org/bukkit/plugin/EventExecutor.java
index 0c9ffc9e5385a798b1d4ac486f37806f9e1e5924..69a9b0cadda06904d8abc3b5ebed108e694c8220 100644
--- a/src/main/java/org/bukkit/plugin/EventExecutor.java
+++ b/src/main/java/org/bukkit/plugin/EventExecutor.java
@@ -37,6 +37,12 @@ public interface EventExecutor {
         com.google.common.base.Preconditions.checkArgument(m.getParameterCount() != 0, "Incorrect number of arguments %s", m.getParameterCount());
         com.google.common.base.Preconditions.checkArgument(m.getParameterTypes()[0] == eventClass, "First parameter %s doesn't match event class %s", m.getParameterTypes()[0], eventClass);
         com.destroystokyo.paper.event.executor.asm.ClassDefiner definer = com.destroystokyo.paper.event.executor.asm.ClassDefiner.getInstance();
+        if (m.getReturnType() != Void.TYPE) {
+            final org.bukkit.plugin.java.JavaPlugin plugin = org.bukkit.plugin.java.JavaPlugin.getProvidingPlugin(m.getDeclaringClass());
+            org.bukkit.Bukkit.getLogger().warning("@EventHandler method " + m.getDeclaringClass().getName() + (java.lang.reflect.Modifier.isStatic(m.getModifiers()) ? '.' : '#') + m.getName()
+                + " returns non-void type " + m.getReturnType().getName() + ". This is unsupported behavior and will no longer work in a future version of Paper."
+                + " This should be reported to the developers of " + plugin.getDescription().getFullName() + " (" + String.join(",", plugin.getDescription().getAuthors()) + ')');
+        }
         if (java.lang.reflect.Modifier.isStatic(m.getModifiers())) {
             return new com.destroystokyo.paper.event.executor.StaticMethodHandleEventExecutor(eventClass, m);
         } else if (definer.isBypassAccessChecks() || java.lang.reflect.Modifier.isPublic(m.getDeclaringClass().getModifiers()) && java.lang.reflect.Modifier.isPublic(m.getModifiers())) {
