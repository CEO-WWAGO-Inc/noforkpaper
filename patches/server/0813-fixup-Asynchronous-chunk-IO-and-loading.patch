From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Spottedleaf <Spottedleaf@users.noreply.github.com>
Date: Mon, 30 Aug 2021 04:13:28 -0700
Subject: [PATCH] fixup! Asynchronous chunk IO and loading


diff --git a/src/main/java/com/destroystokyo/paper/PaperConfig.java b/src/main/java/com/destroystokyo/paper/PaperConfig.java
index fc69d07444be2442d2e030fdafc8b16d6d0728fa..673b2a4a207705e8f932fe5c085cc6270d9c977b 100644
--- a/src/main/java/com/destroystokyo/paper/PaperConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperConfig.java
@@ -411,9 +411,13 @@ public class PaperConfig {
         section.set("thread-per-world-generation", null);
 
         int threads = getInt("settings.async-chunks.threads", -1);
-        int cpus = Runtime.getRuntime().availableProcessors();
+        int cpus = Runtime.getRuntime().availableProcessors() / 2;
         if (threads <= 0) {
-            threads = (int) Math.min(Integer.getInteger("paper.maxChunkThreads", 8), Math.max(1, cpus - 1));
+            if (cpus <= 4) {
+                threads = cpus <= 2 ? 1 : 2;
+            } else {
+                threads = (int) Math.min(Integer.getInteger("paper.maxChunkThreads", 4), cpus / 2);
+            }
         }
         if (cpus == 1 && !Boolean.getBoolean("Paper.allowAsyncChunksSingleCore")) {
             asyncChunks = false;
