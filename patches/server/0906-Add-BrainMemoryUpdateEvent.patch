From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Togira <70365614+Togira123@users.noreply.github.com>
Date: Mon, 23 May 2022 20:12:27 +0200
Subject: [PATCH] Add BrainMemoryUpdateEvent


diff --git a/src/main/java/net/minecraft/world/entity/ai/Brain.java b/src/main/java/net/minecraft/world/entity/ai/Brain.java
index f14139d43abfada8f922e13b55092d880a62f7dc..d0c2ee8f1b8ba84c6896a5302e58de5067a7fb09 100644
--- a/src/main/java/net/minecraft/world/entity/ai/Brain.java
+++ b/src/main/java/net/minecraft/world/entity/ai/Brain.java
@@ -163,10 +163,23 @@ public class Brain<E extends LivingEntity> {
             if (memory.isPresent() && this.isEmptyCollection(memory.get().getValue())) {
                 this.eraseMemory(type);
             } else {
-                this.memories.put(type, memory);
+                // Paper start - check whether memory is being added/changed/deleted
+                io.papermc.paper.event.entity.BrainMemoryUpdateEvent.Type changeType = null;
+                if (!memory.isPresent()) {
+                    changeType = io.papermc.paper.event.entity.BrainMemoryUpdateEvent.Type.DELETE;
+                } else if (hasMemoryValue(type)) {
+                    changeType = io.papermc.paper.event.entity.BrainMemoryUpdateEvent.Type.CHANGE;
+                } else {
+                    changeType = io.papermc.paper.event.entity.BrainMemoryUpdateEvent.Type.ADD;
+                }
+                if (new io.papermc.paper.event.entity.BrainMemoryUpdateEvent(
+                        org.bukkit.craftbukkit.entity.memory.CraftMemoryKey.toMemoryKey(type),
+                        changeType).callEvent()) {
+                    this.memories.put(type, memory);
+                }
+                // Paper end
             }
         }
-
     }
 
     public <U> Optional<U> getMemory(MemoryModuleType<U> type) {
